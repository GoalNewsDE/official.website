<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8">
<title>Hand & Face Tracking</title>
<style>
body {
    background: #0d0d0d;
    color: white;
    font-family: Arial, sans-serif;
    text-align: center;
    margin: 0;
    padding: 0;
}
h1 {
    margin-top: 20px;
    font-size: 32px;
}
video, canvas {
    margin-top: 20px;
    width: 90%;
    max-width: 600px;
    border-radius: 20px;
    box-shadow: 0 0 30px #0f0;
}
#info {
    margin-top: 15px;
    font-size: 20px;
}
</style>
</head>
<body>
<h1>ðŸ¤– Hand & Face Tracking</h1>
<video id="video" autoplay playsinline muted></video>
<canvas id="canvas"></canvas>
<div id="info">Finger: 0</div>

<script src="https://cdn.jsdelivr.net/npm/@mediapipe/hands/hands.js"></script>
<script src="https://cdn.jsdelivr.net/npm/@mediapipe/face_detection/face_detection.js"></script>
<script src="https://cdn.jsdelivr.net/npm/@mediapipe/drawing_utils/drawing_utils.js"></script>
<script src="https://cdn.jsdelivr.net/npm/@mediapipe/camera_utils/camera_utils.js"></script>

<script>
const videoElement = document.getElementById('video');
const canvasElement = document.getElementById('canvas');
const ctx = canvasElement.getContext('2d');
const info = document.getElementById('info');

let fingerCount = 0;

// ZÃ¤hlt offene Finger (Daumen, Zeige, Mittel, Ring, Pinky)
function countFingers(landmarks) {
    if (!landmarks) return 0;
    let count = 0;
    if (landmarks[4].x < landmarks[3].x) count++;    // Daumen
    if (landmarks[8].y < landmarks[6].y) count++;    // Zeigefinger
    if (landmarks[12].y < landmarks[10].y) count++;  // Mittelfinger
    if (landmarks[16].y < landmarks[14].y) count++;  // Ringfinger
    if (landmarks[20].y < landmarks[18].y) count++;  // kleiner Finger
    return count;
}

// Mediapipe Hands Setup
const hands = new Hands({locateFile: (file) => {
    return `https://cdn.jsdelivr.net/npm/@mediapipe/hands/${file}`;
}});
hands.setOptions({
    maxNumHands: 2,
    minDetectionConfidence: 0.7,
    minTrackingConfidence: 0.7
});
hands.onResults(results => {
    draw(results);
});

// Mediapipe Face Detection Setup
const face = new FaceDetection({locateFile: (file) => {
    return `https://cdn.jsdelivr.net/npm/@mediapipe/face_detection/${file}`;
}});
face.setOptions({
    minDetectionConfidence: 0.7
});
face.onResults(results => {
    draw(results);
});

// Zeichnen der Ergebnisse
function draw(results) {
    canvasElement.width = videoElement.videoWidth;
    canvasElement.height = videoElement.videoHeight;
    ctx.clearRect(0,0,canvasElement.width, canvasElement.height);
    ctx.drawImage(videoElement, 0, 0, canvasElement.width, canvasElement.height);

    // Hand-Landmarks
    if (results.multiHandLandmarks) {
        for (const landmarks of results.multiHandLandmarks) {
            drawConnectors(ctx, landmarks, HAND_CONNECTIONS, {color:'#00FF00', lineWidth:4});
            drawLandmarks(ctx, landmarks, {color:'#FF0000', lineWidth:2});
            fingerCount = countFingers(landmarks);
            info.innerText = "Finger: " + fingerCount;
        }
    }

    // Gesichtserkennung
    if (results.detections) {
        for (const detection of results.detections) {
            drawDetection(ctx, detection);
        }
    }
}

// Kamera starten
const camera = new Camera(videoElement, {
    onFrame: async () => {
        await hands.send({image: videoElement});
        await face.send({image: videoElement});
    },
    width:640,
    height:480
});
camera.start();
</script>
</body>
</html>
